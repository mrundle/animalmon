<head>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
	<script>
	$(document).ready(function(){
		// jQuery methods go here
		// set up the JSON to send to the API
		var to_send = {};
		to_send.type = 'update';
    
		var to_send_JSON = JSON.stringify(to_send);

		// make the POST request
		$.post('../../api.php',to_send)
		.done(function(data){
			updateGameStateRep(data);
		});

		//call a function to handle if any of the moves are clicked
		$('#move1Btn').click(function(){
			handleMoveClick('move1');
		});

		$('#move2Btn').click(function(){
			handleMoveClick('move2');
		});

		$('#move3Btn').click(function(){
			handleMoveClick('move3');
		});

		$('#move4Btn').click(function(){
			handleMoveClick('move4');
		});
	});

	//a move was just clicked
	function handleMoveClick(buttonClicked){

		move = document.getElementById(buttonClicked + 'Btn').innerHTML;
		if(gameState['battleTeam1'][gameState['battleTeam1']['currentAnimalmon']]['MOVES'][move]['CURRENT_POWER_POINTS'] < 1){
			window.alert('THAT MOVE HAS NO MORE POWERPOINTS!!! :(');
		}else{
			var to_send = {};
			to_send.type = 'move';
			to_send.move = move
	    
			var to_send_JSON = JSON.stringify(to_send);

			// make the POST request
			$.post('../../api.php',to_send)
			.done(function(data){
				updateGameStateRep(data);
				updateBattleLog(data);
			});
		}
	}

	function updateGameStateRep(data){
		//set current animalmon
//		window.alert(data);
		parsed_data = JSON.parse(data);
		gameState = parsed_data["gameState"];
		$('#currentAnimalmon1').text(gameState['battleTeam1']['currentAnimalmon'] + " ------ Health: "+ gameState['battleTeam1'][gameState['battleTeam1']['currentAnimalmon']]['STATS']['HEALTH'] + "/" + gameState['battleTeam1'][gameState['battleTeam1']['currentAnimalmon']]['STATS']['MAX_HEALTH']);
		$('#currentAnimalmon2').text(gameState['battleTeam2']['currentAnimalmon'] + " ------ Health: "+ gameState['battleTeam2'][gameState['battleTeam2']['currentAnimalmon']]['STATS']['HEALTH'] + "/" + gameState['battleTeam2'][gameState['battleTeam2']['currentAnimalmon']]['STATS']['MAX_HEALTH']);
		//set current moveset
		var moves = Object.keys(gameState['battleTeam1'][gameState['battleTeam1']['currentAnimalmon']]['MOVES']);
		var numMoves = moves.length;
		for(var i = 0; i < 4; i++){
			if( i < numMoves){
				$('#move' + (i+1) + 'Btn').text(moves[i]);
				$('#move' + (i+1) + 'Label').text("Power Points: " + gameState['battleTeam1'][gameState['battleTeam1']['currentAnimalmon']]['MOVES'][moves[i]]['CURRENT_POWER_POINTS'] + "/" + gameState['battleTeam1'][gameState['battleTeam1']['currentAnimalmon']]['MOVES'][moves[i]]['POWER_POINTS']);
			} else {
				document.getElementById('move'+ (i+1) + 'Btn').style.visibility = 'hidden';
				document.getElementById('move'+ (i+1) + 'Label').style.visibility = 'hidden';
			}
		}
	}

	function updateBattleLog(data){
		parsed_data = JSON.parse(data);
		gameState = parsed_data["gameState"];
		window.alert(data);
		var battleLog = '';
		if(gameState['battleTeam1']['battleLog']['move_type'] == 'damage'){
			if(gameState['battleTeam1']['battleLog']['hit'] == false){
				battleLog = "you used " + gameState['battleTeam1']['battleLog']['move'] + "...<br>" + "but missed!";
				document.getElementById('battleLog').innerHTML = battleLog;
			}
			else{
				battleLog = "you used " + gameState['battleTeam1']['battleLog']['move'] + "...<br>" + "and hit for " + gameState['battleTeam1']['battleLog']['damage'] + "!";
				if(gameState['battleTeam1']['battleLog']['crit'] == true){
					battleLog += "<br> CRITICAL HIT!!!";
				}
				document.getElementById('battleLog').innerHTML = battleLog;
			}
		}
		else{
			if(gameState['battleTeam1']['battleLog']['hit'] == false){
				battleLog = "you used " + gameState['battleTeam1']['battleLog']['move'] + "...<br>" + "but missed!";
				document.getElementById('battleLog').innerHTML = battleLog;
			}
			else{
				battleLog = "you used " + gameState['battleTeam1']['battleLog']['move'] "...<br>";
				document.getElementById('battleLog').innerHTML = battleLog;
			}
		}
	}

	</script>
</head>
<body>

<center>
	<h2>BATTLE TEST DRIVER</h2>
</center>

<hr style="margin-top:30px; margin-bottom:30px;">
<div>
	<p><b>Your Current Animalmon:</b></p>
	<p id='currentAnimalmon1'></p>
</div>
<div>
	<p><b>Foes Current Animalmon:</b></p>
	<p id='currentAnimalmon2'></p>
</div>
<div>
	<label for='moves'><b>MOVES</b></label>
</div>
<div>
	<button id='move1Btn'><b>move1</b></button>
	<label for='move1' id=move1Label>move1</label>
</div>
<div>
	<button id='move2Btn'><b>move2</b></button>
	<label for='move2' id=move2Label>move2</label>
</div>
<div>
	<button id='move3Btn'><b>move3</b></button>
	<label for='move3' id=move3Label>move3</label>
</div>
<div>
	<button id='move4Btn'><b>move4</b></button>
	<label for='move4' id=move4Label>move4</label>
</div>
<div>
	<p id='battleLog'>Select a move or change animalmon!</p>
</div>
