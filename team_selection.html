<!DOCTYPE html>
<head>

    <title>Animalmon</title>

    <!-- FONT -->
    <link href='//fonts.googleapis.com/css?family=Raleway:400,300,600' rel='stylesheet' type='text/css'>

    <!-- CSS -->
    <link rel="stylesheet" href="dist/css/normalize.css">
    <link rel="stylesheet" href="dist/css/skeleton.css">
    <link rel="stylesheet" href="css/custom.css">
    <link rel="stylesheet" href="css/animalmon.css">
    <!-- IMPORT JQUERY (from Google CDN)
    ----------------------------------------- -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

    <!-- INCLUDE OTHER JAVASCRIPT FILES
    ----------------------------------------- -->
    <script type='text/javascript' src='js/debug.js'></script> <!-- GLOBAL DEBUG VARIABLE -->

    <!-- JQUERY SCRIPT
    ----------------------------------------- -->
    <script>
    $(document).ready(function(){
        // jQuery methods go here
        
        $('#animalSelection').ready(function(){
            
            // set up the JSON to send to the API
            var to_send = {};
            to_send.type = "view_animal_options";
            to_send.secret = localStorage.getItem("secret");
            var to_send_JSON = JSON.stringify(to_send);
	
            // make the POST request
            $.post('api.php',to_send)
            .done(function(data){
                // debugging purposes
                if(GLOBAL_DEBUG_ON){
                  alert('API returned: ' + data);
                }
                
                parsed_data = JSON.parse(data);
		
                if (parsed_data["status"] === "pass") {
                    var animals = parsed_data['animals']['NAME'];
                    var images = parsed_data['animals']['IMG'];	
                    for(var i = 0; i < animals.length; i++){
                      var name = String(animals[i]);
                      var image = './img/animals/100x100/' + String(images[i]);
                      var checkbox = "<input type='checkbox' value='" + name + "'></input>";
                      var image = "<img src='" + image + "' width=100 height=100>";
                      var row = "<tr><td>" + checkbox + "</td><td>" + name + "</td><td>" + image + "</td><td>" + '...' + "</td></tr>";
                      $( "#animal_options_table").find('tbody').append(row);
                    }
                } else {
                    alert("API call unsuccessful: " + parsed_data['message']);
                }
            });
        });

        $('#selectBtn').click(function(){
            alert('click');
            var num_checked = 0;
            var animals_chosen = [];
            // Count how many animals are chosen
            $('input[type=checkbox]').each(function(){
                if(this.checked){
                    num_checked = num_checked + 1;
                    animals_chosen.push($(this).val());
                }
            });
            if(num_checked != 6){
                alert('You need to select 6 animals!');
            }
            else{
                alert('here we go');
                // send the chosen animals to the server
                var to_send = {};
                to_send.type = "startgame";
                to_send.secret = localStorage.getItem("secret");
                to_send.animals = animals_chosen;
                var to_send_JSON = JSON.stringify(to_send);
                // make the POST request
                $.post('api.php',to_send)
                .done(function(data){
                    // debugging purposes
                    if(GLOBAL_DEBUG_ON){
                      alert('API returned: ' + data);
                    }
                    parsed_data = JSON.parse(data);
		
                    if (parsed_data["status"] === "pass") {
                      alert('success!');
                      // redirect to the battle page
		      window.location.replace('./api/battleMechanics/battleStateText.html');
                    }
                    else{
                      alert('fail...' + data);
                    }
                });         
            }
        });


    });

    </script>
  

    <center style="font-family:Helvetica">
	    <title>Animalmon</title>
	    <img src="http://img1.wikia.nocookie.net/__cb20100714172711/u__/unanswers/images/thumb/8/88/Real_animals_made_to_look_like_pokemon.png/500px-Real_animals_made_to_look_like_pokemon.png" alt="Insert cool picture here.">
	    <h1>Animalmon!</h1>
    </center>
    <hr style="margin-top:30px; margin-bottom:30px;">
</head>
<body>
<container>
    <center>
    <table id='animal_options_table'>
        <thead>
            <tr>
                <td></td>
                <td>Animal</td>
                <td>Image</td>
                <td>Stats</td>
            <tr>
        </thead>
        <tbody>

        </tbody>
    </table>
    </center>
   
    <button id='selectBtn'>Battle!</button>
</container>
</body>
</html>
